<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Week 40 Practice Quiz</title>
    <style>
        /* --- Color Variables --- */
        :root {
            /* Default: Dark Theme */
            --bg-color: #2d343e; /* Dark background */
            --container-bg: #3c424f; /* Slightly lighter container */
            --text-color: #e8e6e3; /* Light text */
            --question-text-color: #8ab4f8; /* Light blue for questions */
            --border-color: #555; /* Darker borders */
            --separator-color: #4a4f5a;
            --label-bg: #454c5a;
            --label-border: #6c757d;
            --label-hover-bg: #525966;
            --label-hover-border: #7a828a;
            --button-bg: #8ab4f8;
            --button-text: #202124;
            --button-hover-bg: #a3c5f9;
            --button-disabled-bg: #5f6368; /* Kept for potential future use, but not used now */
            --feedback-correct-bg: #344e41;
            --feedback-correct-text: #c7f9cc;
            --feedback-correct-border: #52b788;
            --feedback-incorrect-bg: #5e2129;
            --feedback-incorrect-text: #f8d7da;
            --feedback-incorrect-border: #a4133c;
            --feedback-rationale-text: #adb5bd; /* Lighter gray for rationale */
            --feedback-separator: #6c757d;
            --radio-accent: #8ab4f8;
        }

        .light-theme {
            --bg-color: #eef2f7;
            --container-bg: #ffffff;
            --text-color: #343a40;
            --question-text-color: #0056b3;
            --border-color: #dee2e6;
            --separator-color: #e9ecef;
            --label-bg: #f8f9fa;
            --label-border: #ced4da;
            --label-hover-bg: #e2e6ea;
            --label-hover-border: #adb5bd;
            --button-bg: #007bff;
            --button-text: white;
            --button-hover-bg: #0056b3;
            --button-disabled-bg: #6c757d;
            --feedback-correct-bg: #d1e7dd;
            --feedback-correct-text: #0f5132;
            --feedback-correct-border: #badbcc;
            --feedback-incorrect-bg: #f8d7da;
            --feedback-incorrect-text: #842029;
            --feedback-incorrect-border: #f5c2c7;
            --feedback-rationale-text: #495057;
            --feedback-separator: #ccc;
            --radio-accent: #007bff;
        }

        /* --- General Styles --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            line-height: 1.7;
            margin: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            padding-bottom: 40px;
            transition: background-color 0.3s, color 0.3s;
        }

        #theme-toggle-button {
            position: fixed;
            top: 15px;
            right: 15px;
            padding: 8px 12px;
            background-color: var(--button-bg);
            color: var(--button-text);
            border: 1px solid var(--label-border);
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            z-index: 1000; /* Ensure it's on top */
             transition: background-color 0.3s, color 0.3s;
        }
         #theme-toggle-button:hover {
             opacity: 0.8;
         }


        #quiz-container {
            max-width: 900px;
            margin: 80px auto 30px auto; /* Added top margin for toggle button */
            background: var(--container-bg);
            padding: 25px 35px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--border-color);
            transition: background-color 0.3s, border-color 0.3s;
        }

        .question-block {
            margin-bottom: 35px;
            padding-bottom: 25px;
            border-bottom: 1px solid var(--separator-color);
            transition: border-color 0.3s;
        }

        .question-block:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 5px;
        }

        .question-text {
            font-weight: 600;
            font-size: 1.1em;
            margin-bottom: 18px;
            color: var(--question-text-color);
            transition: color 0.3s;
        }

        .options label {
            display: block;
            margin-bottom: 12px;
            cursor: pointer;
            padding: 10px 15px;
            border-radius: 6px;
            border: 1px solid var(--label-border);
            background-color: var(--label-bg);
            transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out;
        }

        .options label:hover {
            background-color: var(--label-hover-bg);
            border-color: var(--label-hover-border);
        }

        .options input[type="radio"]:checked+span {
             font-weight: bold;
             color: var(--question-text-color);
        }
        .options input[type="radio"] {
            margin-right: 12px;
            accent-color: var(--radio-accent);
            /* Allow unchecking by clicking again (browser dependent) */
            /* A more robust solution requires JS, but this is a simple approach */
             cursor: pointer;
        }

        .check-button {
            display: block;
            margin-top: 15px;
            padding: 8px 15px;
            background-color: var(--button-bg);
            color: var(--button-text);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.95em;
            transition: background-color 0.2s, color 0.2s;
        }

        .check-button:hover {
            opacity: 0.85;
        }

         /* Removed disabled style for button */
         /* .check-button:disabled {
             background-color: var(--button-disabled-bg);
             cursor: not-allowed;
             opacity: 0.7;
         } */

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            font-size: 0.95em;
            display: none; /* Start hidden */
            border: 1px solid transparent;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }

        .feedback.correct {
            background-color: var(--feedback-correct-bg);
            color: var(--feedback-correct-text);
            border-color: var(--feedback-correct-border);
            display: block; /* Show feedback */
        }

        .feedback.incorrect {
            background-color: var(--feedback-incorrect-bg);
            color: var(--feedback-incorrect-text);
            border-color: var(--feedback-incorrect-border);
            display: block; /* Show feedback */
        }

        .feedback-status {
             font-weight: bold;
             font-size: 1.1em;
             display: block;
             margin-bottom: 8px;
        }

        .feedback-rationale {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed var(--feedback-separator);
            font-size: 0.9em;
            color: var(--feedback-rationale-text);
             transition: color 0.3s, border-color 0.3s;
        }

        h1 {
            text-align: center;
            color: var(--question-text-color); /* Use question text color */
            margin-top: 30px;
            margin-bottom: 30px;
            font-weight: 600;
            transition: color 0.3s;
        }
         .lecture-source {
             font-size: 0.8em;
             font-style: italic;
             color: var(--feedback-rationale-text); /* Or choose a subtle color */
             margin-bottom: 10px;
             display: block; /* Ensure it takes its own line */
         }

        /* Removed styles related to .answered class */
        /*
        .question-block.answered .options label {
            cursor: default;
            opacity: 0.6;
        }
         .question-block.answered .options label:hover {
            background-color: var(--label-bg);
            border-color: var(--label-border);
         }
        */

    </style>
</head>
<body>

    <button id="theme-toggle-button">Toggle Theme</button>
    <h1>Week 40 Practice Quiz</h1>

    <div id="quiz-container">
        <!-- Questions will be loaded here by JavaScript -->
    </div>

    <script>
        const quizData = [
             // Histology (Zhang) - LO1 - Rewritten for application/scenario
             {
                 question: "A patient has a bacterial infection entering the liver via the portal vein. Which liver cell, residing within the lumen of the sinusoids, is primarily responsible for phagocytosing these bacteria?",
                 options: {
                     A: "Hepatocyte",
                     B: "Kupffer cell",
                     C: "Endothelial cell",
                     D: "Hepatic stellate (Ito) cell"
                 },
                 correctAnswer: "B",
                 lecture: "Histology of the Liver, Pancreas, and Gallbladder (Zhang)",
                 lo: 1,
                 rationale: "Kupffer cells are resident macrophages located within the vascular lumen of the liver sinusoids, specialized for phagocytosing bacteria, old red blood cells, and debris from the incoming blood. Hepatocytes are the main parenchymal cells forming cords. Endothelial cells line the sinusoids. Hepatic stellate cells are located in the Space of Disse, outside the sinusoidal lumen. (Source: Zhang, Slide 13)"
             },
             // Histology (Zhang) - LO2 - Rewritten for application (identifying structure by function)
             {
                 question: "Microscopic examination of a liver biopsy identifies a structure at the periphery of a lobule containing branches of a vein (carrying nutrient-rich blood from the intestine), an artery (carrying oxygenated blood), and a bile ductule (draining bile from the lobule). This structure, responsible for the inflow and outflow at the lobule periphery, is called a:",
                 options: {
                     A: "Central vein",
                     B: "Hepatic sinusoid",
                     C: "Portal triad",
                     D: "Space of Disse"
                 },
                 correctAnswer: "C",
                 lecture: "Histology of the Liver, Pancreas, and Gallbladder (Zhang)",
                 lo: 2,
                 rationale: "A portal triad (or portal tract) is found at the periphery of classic hepatic lobules and characteristically contains branches of the portal vein, hepatic artery, and a bile ductule, often accompanied by lymphatics and nerves, within connective tissue. Blood flows from the portal triad components into the sinusoids, towards the central vein. Bile flows in the opposite direction, away from the central vein, into the bile ductules of the portal triad. (Source: Zhang, Slide 8, 19)"
             },
              // Histology (Zhang) - LO3 - Rewritten for clarity and parallel options
             {
                 question: "In a classic hepatic lobule, blood flows from the portal triads towards the central vein. In which direction does bile flow relative to this blood flow?",
                 options: {
                     A: "In the same direction",
                     B: "In the opposite direction (counter-current)",
                     C: "Perpendicular to blood flow",
                     D: "Directly into the sinusoids along with blood"
                 },
                 correctAnswer: "B",
                 lecture: "Histology of the Liver, Pancreas, and Gallbladder (Zhang)",
                 lo: 3,
                 rationale: "Bile flows within bile canaliculi centrifugally (away from the central vein) towards the bile ductules located in the portal triads at the periphery of the lobule. This is opposite to the direction of blood flow, which is centripetal (towards the central vein). (Source: Zhang, Slide 15, 16)"
             },
              // Histology (Zhang) - LO4 - Rewritten for application (contrasting models based on function)
             {
                 question: "The liver microarchitecture can be conceptually organized as either classic lobules (hexagonal, centered on a central vein) or hepatic acini (functional units centered on portal triads). Which model is more useful for understanding the metabolic zonation of hepatocytes based on oxygen and nutrient gradients, and predicting the zones most susceptible to ischemic or toxic injury?",
                 options: {
                     A: "The classic lobule model",
                     B: "The hepatic acinus model",
                     C: "Both models are equally useful",
                     D: "Neither model explains zonation or injury susceptibility"
                 },
                 correctAnswer: "B",
                 lecture: "Histology of the Liver, Pancreas, and Gallbladder (Zhang)",
                 lo: 4,
                 rationale: "The hepatic acinus model provides a functional organization that better correlates with blood flow patterns, oxygen/nutrient gradients, and metabolic zonation within the liver. This zonation helps explain why certain areas (like zone 3, pericentral) are more vulnerable to injury from conditions like ischemia or metabolism of toxins. (Source: Zhang, Slide 28, 29, 30)"
             },
             // Histology (Zhang) - LO5 - Rewritten for recognition of key features
             {
                 question: "Microscopic examination of a gallbladder specimen reveals prominent folds in the mucosal lining. The lining epithelium consists of a single layer of tall, absorptive columnar cells. The wall contains a well-developed smooth muscle layer, but lacks a muscularis mucosae and submucosa. Which of the following is a characteristic histological feature of the gallbladder wall?",
                 options: {
                     A: "Stratified squamous epithelium lining the mucosa",
                     B: "Presence of abundant lymphoid follicles in the submucosa",
                     C: "Highly folded mucosa lined by simple columnar epithelium and absence of muscularis mucosae",
                     D: "A prominent muscularis externa composed of skeletal muscle"
                 },
                 correctAnswer: "C",
                 lecture: "Histology of the Liver, Pancreas, and Gallbladder (Zhang)",
                 lo: 5,
                 rationale: "Key histological features of the gallbladder include a highly folded mucosa lined by simple columnar epithelium adapted for water absorption, a distinct smooth muscle layer, and the absence of a muscularis mucosae and submucosa. (Source: Zhang, Slide 33, 34)"
             },
              // Histology (Zhang) - LO6 - Rewritten for recognition based on description
             {
                 question: "Microscopic examination of a pancreas specimen shows clusters of cells interspersed among the exocrine acini. These cell clusters stain paler than the surrounding tissue, are richly vascularized, and contain cells that produce hormones like insulin and glucagon, which are secreted directly into the bloodstream. These clusters represent the endocrine component of the pancreas and are called:",
                 options: {
                     A: "Pancreatic acini",
                     B: "Centroacinar cells",
                     C: "Islets of Langerhans",
                     D: "Intercalated ducts"
                 },
                 correctAnswer: "C",
                 lecture: "Histology of the Liver, Pancreas, and Gallbladder (Zhang)",
                 lo: 6,
                 rationale: "The Islets of Langerhans are the functional units of the endocrine pancreas, responsible for hormone production and secretion. Pancreatic acini are exocrine units. Centroacinar cells and intercalated ducts are parts of the exocrine duct system. (Source: Zhang, Slide 35, 42)"
             },
              // Histology (Zhang) - LO7 - Rewritten for recognition based on description
             {
                 question: "Microscopic examination of a pancreas specimen reveals clusters of serous cells responsible for synthesizing and secreting digestive enzymes. These cells are typically pyramidal-shaped with basally located nuclei and apical zymogen granules. These structures, forming the exocrine functional unit, are called:",
                 options: {
                     A: "Islets of Langerhans",
                     B: "Pancreatic acini",
                     C: "Interlobular ducts",
                     D: "Centroacinar cells"
                 },
                 correctAnswer: "B",
                 lecture: "Histology of the Liver, Pancreas, and Gallbladder (Zhang)",
                 lo: 7,
                 rationale: "Pancreatic acini are the exocrine units composed of acinar cells that produce digestive enzymes packaged in zymogen granules. These acini secrete their products into a duct system that begins with centroacinar cells and intercalated ducts. (Source: Zhang, Slide 36, 37)"
             },
             // Physiology Liver (Krzywanski) - LO1 - Rewritten for recognition based on description
              {
                  question: "Hepatocytes exhibit distinct structural and functional domains on their cell surface. The membrane facing the bile canaliculus is specialized for bile secretion, while the membrane facing the sinusoid is specialized for exchange with blood. This intrinsic difference between these two membrane domains is referred to as hepatocyte:",
                  options: {
                      A: "Fenestration",
                      B: "Polarization",
                      C: "Glycosylation",
                      D: "Phagocytosis"
                  },
                  correctAnswer: "B",
                  lecture: "Physiology of Liver and Biliary Tree (Krzywanski)",
                  lo: 1,
                  rationale: "Polarization in epithelial cells like hepatocytes refers to the structural and functional differentiation of the apical and basolateral membrane domains, allowing for vectorial transport of substances. (Source: Krzywanski, Slide 2 LO1, Slide 8)"
              },
              // Physiology Liver (Krzywanski) - LO2 - Original, assesses application
              {
                  question: "A patient presents shortly after consuming a meal rich in carbohydrates. Which major metabolic process is primarily stimulated in the liver by the resulting increase in blood glucose and insulin, serving to store excess glucose and prevent immediate hyperglycemia?",
                  options: {
                      A: "Gluconeogenesis",
                      B: "Glycogenolysis",
                      C: "Glycogen synthesis (Glycogenesis)",
                      D: "Fatty acid oxidation"
                  },
                  correctAnswer: "C",
                  lecture: "Physiology of Liver and Biliary Tree (Krzywanski)",
                  lo: 2,
                  rationale: "Following a carbohydrate-rich meal, the liver takes up glucose and converts it into glycogen for storage (glycogenesis), acting as a glucose buffer. Gluconeogenesis and glycogenolysis are processes that release glucose, typically active during fasting. (Source: Krzywanski, Slide 11, 12)"
              },
               // Physiology Liver (Krzywanski) - LO3 - Original, assesses application
              {
                  question: "An infant presents with jaundice. Laboratory tests reveal elevated levels of unconjugated bilirubin. This molecule is generated from heme breakdown but is lipid-soluble and cannot be efficiently excreted. In the liver, unconjugated bilirubin must undergo which modification to become water-soluble and excretable in bile?",
                  options: {
                      A: "Oxidation",
                      B: "Reduction",
                      C: "Conjugation with glucuronic acid",
                      D: "Hydrolysis"
                  },
                  correctAnswer: "C",
                  lecture: "Physiology of Liver and Biliary Tree (Krzywanski)",
                  lo: 3,
                  rationale: "Hepatocytes conjugate unconjugated bilirubin primarily with one or two molecules of glucuronic acid, catalyzed by UDP-glucuronosyltransferase. This process makes bilirubin water-soluble, allowing it to be secreted into bile for elimination. (Source: Krzywanski, Slide 19, 20)"
              },
              // Physiology Liver (Krzywanski) - LO4 - Rewritten for application/scenario
              {
                  question: "A patient with chronic cholestatic liver disease experiences impaired lipid digestion due to decreased bile flow into the intestine. Which essential component of bile, synthesized by hepatocytes from cholesterol, is primarily responsible for the emulsification of dietary fats in the small intestine, a process crucial for subsequent digestion and absorption?",
                  options: {
                      A: "Bilirubin",
                      B: "Cholesterol",
                      C: "Bile salts",
                      D: "Phospholipids"
                  },
                  correctAnswer: "C",
                  lecture: "Physiology of Liver and Biliary Tree (Krzywanski)",
                  lo: 4,
                  rationale: "Bile salts are amphipathic molecules that emulsify large fat globules into smaller droplets, increasing the surface area for enzymatic digestion by lipases. This is a key function of bile and bile salts. Bilirubin is a waste product, cholesterol is primarily excreted, and phospholipids also contribute to micelle formation but bile salts are the primary emulsifiers. (Source: Krzywanski, Slide 3, 29, 30, 35, 36)"
              },
              // Physiology Pancreas (Stepp) - LO1 - Rewritten for recognition based on description
              {
                  question: "Microscopic examination of pancreatic tissue reveals discrete clusters of cells scattered among the exocrine acini. These clusters are highly vascularized and produce hormones such as insulin, glucagon, somatostatin, and pancreatic polypeptide, which are secreted directly into the bloodstream. These clusters represent the endocrine component of the pancreas and are called:",
                  options: {
                      A: "Pancreatic acini",
                      B: "Centroacinar cells",
                      C: "Islets of Langerhans",
                      D: "Intercalated ducts"
                  },
                  correctAnswer: "C",
                  lecture: "Physiology of Pancreas (Stepp)",
                  lo: 1,
                  rationale: "The Islets of Langerhans are the functional units of the endocrine pancreas, responsible for hormone production and secretion. Pancreatic acini are exocrine units. Centroacinar cells and intercalated ducts are parts of the exocrine duct system. (Source: Stepp, Slide 3, 42)"
              },
              // Physiology Pancreas (Stepp) - LO2 - Original, assesses application
              {
                  question: "Following a carbohydrate-rich meal, blood glucose levels rise. Insulin is released from pancreatic β-cells and exerts effects on various tissues to maintain glucose homeostasis. Which of the following best describes the central role of insulin in whole-body glucose homeostasis after a meal?",
                  options: {
                      A: "Stimulating hepatic glucose output",
                      B: "Promoting glucose uptake and storage in peripheral tissues and suppressing hepatic glucose production",
                      C: "Increasing glucose absorption from the gastrointestinal tract",
                      D: "Enhancing fatty acid release from adipose tissue"
                  },
                  correctAnswer: "B",
                  lecture: "Physiology of Pancreas (Stepp)",
                  lo: 2,
                  rationale: "Insulin's primary actions post-meal are to promote glucose uptake (especially in muscle and adipose tissue), stimulate glycogen and fat synthesis (storage), and suppress hepatic glucose production (glycogenolysis and gluconeogenesis). (Source: Stepp, Slide 2, 11, 13, 14, 15, 16, 21)"
              },
              // Physiology Pancreas (Stepp) - LO3 - Original, assesses application
              {
                  question: "Glucose stimulates insulin secretion from pancreatic β-cells. This process involves glucose uptake via GLUT2, metabolism leading to increased ATP, closure of ATP-sensitive K+ channels, membrane depolarization, opening of voltage-gated Ca2+ channels, Ca2+ influx, and exocytosis of insulin-containing vesicles. What is the crucial intracellular event that links glucose metabolism to the subsequent electrical and secretory responses in the β-cell?",
                  options: {
                      A: "Activation of adenylyl cyclase",
                      B: "Increased production of ATP",
                      C: "Binding of insulin to its receptor",
                      D: "Activation of glucagon receptors"
                  },
                  correctAnswer: "B",
                  lecture: "Physiology of Pancreas (Stepp)",
                  lo: 3,
                  rationale: "Glucose entry and metabolism in the β-cell increase the intracellular ATP/ADP ratio. This increased ATP is the key signal that closes ATP-sensitive K+ channels, initiating the depolarization cascade leading to insulin release. (Source: Stepp, Slide 5)"
              },
              // Physiology Pancreas (Stepp) - LO4 - Original, assesses application
              {
                  question: "Insulin is known primarily for its effects on glucose metabolism, but it also has significant effects on protein and lipid metabolism. Which of the following represents an anabolic action of insulin related to protein?",
                  options: {
                      A: "Stimulating gluconeogenesis in the liver",
                      B: "Increasing protein degradation in muscle",
                      C: "Promoting amino acid uptake and protein synthesis in tissues",
                      D: "Enhancing urea formation in the liver"
                  },
                  correctAnswer: "C",
                  lecture: "Physiology of Pancreas (Stepp)",
                  lo: 4,
                  rationale: "Insulin is a major anabolic hormone for protein metabolism. It stimulates the transport of amino acids into cells and promotes protein synthesis, while inhibiting protein degradation and the use of amino acids for gluconeogenesis. (Source: Stepp, Slide 17)"
              },
              // Physiology Pancreas (Stepp) - LO5 - Rewritten for recognition based on description
              {
                  question: "During fasting, blood glucose levels fall, reducing insulin secretion. The pancreas responds by increasing the secretion of a hormone that acts primarily on the liver to stimulate the breakdown of glycogen (glycogenolysis) and the synthesis of glucose from non-carbohydrate precursors (gluconeogenesis), thereby raising blood glucose. What is this key counter-regulatory hormone?",
                  options: {
                      A: "Somatostatin",
                      B: "Glucagon",
                      C: "Amylin",
                      D: "Insulin"
                  },
                  correctAnswer: "B",
                  lecture: "Physiology of Pancreas (Stepp)",
                  lo: 5,
                  rationale: "Glucagon, secreted by pancreatic alpha cells, is the primary hormone that opposes insulin's actions by promoting glucose production and release from the liver, crucial for maintaining blood glucose levels during fasting. Insulin lowers blood glucose. (Source: Stepp, Slide 2, 19, 20, 21)"
              },
              // Pathology Liver (Barrett) - LO1 - Original, assesses recognition
              {
                  question: "Microscopic examination of a liver biopsy from a patient with drug-induced liver injury shows enlarged hepatocytes with pale, empty-appearing cytoplasm and peripheral displacement of the nucleus by large lipid droplets, consistent with fat accumulation. In other areas, hepatocytes contain many small lipid droplets that do not displace the nucleus. These two patterns of fat accumulation are described by which respective terms?",
                  options: {
                      A: "Ballooning degeneration and cholestasis",
                      B: "Macrovesicular steatosis and microvesicular steatosis",
                      C: "Apoptosis and necrosis",
                      D: "Mallory-Denk bodies and ground-glass hepatocytes"
                  },
                  correctAnswer: "B",
                  lecture: "Pathology of the Liver (Barrett)",
                  lo: 1,
                  rationale: "Steatosis is the accumulation of fat in hepatocytes. Macrovesicular steatosis is characterized by large lipid droplets that displace the nucleus. Microvesicular steatosis is characterized by small lipid droplets that do not displace the nucleus. Recognizing these patterns is a key part of identifying hepatic injury. (Source: Barrett - Liver Path, Slide 9, 19)"
              },
               // Pathology Liver (Barrett) - LO4 - Original, assesses application
              {
                  question: "A patient with long-standing chronic liver disease requires a liver transplant. The explanted liver is shrunken, firm, and diffusely nodular. Microscopic examination reveals dense bands of fibrous tissue forming septa that surround regenerative nodules of hepatocytes, disrupting the normal liver architecture. Laboratory findings prior to transplant included low serum albumin and a prolonged prothrombin time. These gross, microscopic, and laboratory findings are hallmarks of which common end-stage liver condition?",
                  options: {
                      A: "Acute hepatitis",
                      B: "Steatohepatitis",
                      C: "Cirrhosis",
                      D: "Hepatic adenoma"
                  },
                  correctAnswer: "C",
                  lecture: "Pathology of the Liver (Barrett)",
                  lo: 4,
                  rationale: "Cirrhosis is the irreversible final stage of various chronic liver diseases, characterized by diffuse fibrosis and nodular regeneration, leading to impaired liver function (manifested by low albumin and coagulopathy) and portal hypertension. (Source: Barrett - Liver Path, Slide 11, 37, 42)"
              },
              // Pathology Liver (Barrett) - LO2 - Original, assesses application
              {
                   question: "A 45-year-old man with a history of alcohol-related cirrhosis presents with lethargy, confusion, and a flapping tremor of his hands (asterixis). Laboratory tests show elevated blood ammonia levels. These clinical findings, occurring in the setting of chronic liver disease, are most consistent with which complication?",
                   options: {
                       A: "Acute cholecystitis",
                       B: "Hepatic encephalopathy",
                       C: "Spontaneous bacterial peritonitis",
                       D: "Hepatocellular carcinoma"
                   },
                   correctAnswer: "B",
                   lecture: "Pathology of the Liver (Barrett)",
                   lo: 2,
                   rationale: "Hepatic encephalopathy is a neuropsychiatric complication of severe liver dysfunction or portosystemic shunting, characterized by altered mental status (lethargy, confusion), cognitive impairment, and neuromuscular signs like asterixis. It is often associated with elevated ammonia levels due to impaired hepatic detoxification. (Source: Barrett - Liver Path, Slide 14, 15)"
               },
              // Pathology Liver (Barrett) - LO3 - Original, assesses application
              {
                  question: "A 52-year-old woman presents with fatigue, pruritus, and jaundice. Laboratory tests are notable for elevated alkaline phosphatase and the presence of anti-mitochondrial antibodies (AMA). A liver biopsy shows chronic inflammation and destruction of small intrahepatic bile ducts, with some granuloma formation. These clinicopathologic features are characteristic of which autoimmune liver disease?",
                  options: {
                      A: "Autoimmune hepatitis",
                      B: "Primary biliary cholangitis (PBC)",
                      C: "Primary sclerosing cholangitis (PSC)",
                      D: "Alcoholic hepatitis"
                  },
                  correctAnswer: "B",
                  lecture: "Pathology of the Liver (Barrett)",
                  lo: 3,
                  rationale: "Primary biliary cholangitis (PBC) is an autoimmune disease targeting the small intrahepatic bile ducts, leading to cholestasis, fibrosis, and cirrhosis. It predominantly affects middle-aged women and is strongly associated with AMA. (Source: Barrett - Liver Path, Slide 46, 47)"
              },
              // Pathology Liver (Barrett) - LO6 - Original, assesses application
              {
                  question: "A 68-year-old man with a history of chronic hepatitis C and cirrhosis presents with unexplained weight loss and increasing abdominal girth. Imaging identifies a new mass in the liver. Serum alpha-fetoprotein (AFP) levels are elevated. A biopsy confirms a malignant neoplasm composed of atypical hepatocytes arranged in thickened cords. These features are diagnostic of which liver tumor?",
                  options: {
                      A: "Hepatic adenoma",
                      B: "Cholangiocarcinoma",
                      C: "Hepatocellular carcinoma (HCC)",
                      D: "Cavernous hemangioma"
                  },
                  correctAnswer: "C",
                  lecture: "Pathology of the Liver (Barrett)",
                  lo: 6,
                  rationale: "Hepatocellular carcinoma (HCC) is a common primary liver cancer, strongly linked to chronic viral hepatitis (HBV/HCV) and cirrhosis. Elevated AFP and characteristic imaging/histologic findings (malignant hepatocytes, altered architecture) are diagnostic. (Source: Barrett - Liver Path, Slide 63)"
              },
               // Biliary/Panc Pathology (Barrett) - LO2 - Original, assesses application
              {
                  question: "A 50-year-old woman with a history of gallstones presents with acute onset of severe right upper quadrant pain, fever, and nausea after a fatty meal. Physical examination reveals localized tenderness and a positive Murphy's sign. Ultrasound shows gallstones and a thickened gallbladder wall with surrounding fluid. These clinical and imaging findings are most consistent with:",
                  options: {
                      A: "Acute cholecystitis",
                      B: "Chronic cholecystitis",
                      C: "Cholangitis",
                      D: "Acute pancreatitis"
                  },
                  correctAnswer: "A",
                  lecture: "Biliary and Pancreatic Pathology (Barrett)",
                  lo: 2,
                  rationale: "The classic presentation of acute cholecystitis includes acute RUQ pain (often post-fatty meal), fever, nausea, and a positive Murphy's sign, usually due to cystic duct obstruction by a gallstone. Ultrasound findings of gallstones and gallbladder inflammation support the diagnosis. Chronic cholecystitis typically presents with recurrent biliary colic. (Source: Barrett - Biliary/Panc Path, Slide 8)"
              },
               // Biliary/Panc Pathology (Barrett) - LO6 - Original, assesses application
              {
                  question: "A 68-year-old man presents with jaundice, weight loss, and vague upper abdominal pain. Imaging reveals a mass in the head of the pancreas causing obstruction of the common bile duct. A biopsy demonstrates a malignant tumor composed of infiltrating glands surrounded by dense fibrous tissue (desmoplasia) and with invasion of nerve bundles (perineural invasion). Serum CA19-9 is elevated. Which pancreatic tumor is most likely?",
                  options: {
                      A: "Chronic pancreatitis",
                      B: "Pancreatic pseudocyst",
                      C: "Pancreatic ductal adenocarcinoma (PDAC)",
                      D: "Insulinoma"
                  },
                  correctAnswer: "C",
                  lecture: "Biliary and Pancreatic Pathology (Barrett)",
                  lo: 6,
                  rationale: "Pancreatic ductal adenocarcinoma (PDAC) is the most common pancreatic malignancy, often arising in the head and causing obstructive jaundice. Histologically, it is characterized by infiltrating malignant glands with prominent desmoplastic stroma and frequent perineural invasion. Chronic pancreatitis is inflammatory. Pseudocysts are fluid collections. Insulinomas are rare, functional neuroendocrine tumors. (Source: Barrett - Biliary/Panc Path, Slide 21, 22, 23, 24)"
              },
              // Biliary/Panc Pathology (Barrett) - LO5 - Original, assesses application
              {
                  question: "A patient with a history of primary sclerosing cholangitis (PSC) presents with worsening jaundice, weight loss, and pruritus. Imaging reveals a dominant stricture and mass at the confluence of the hepatic ducts (porta hepatis). Biopsy of the mass confirms an adenocarcinoma arising from the bile duct epithelium. What is the most likely diagnosis?",
                  options: {
                      A: "Hepatocellular carcinoma",
                      B: "Gallbladder cancer",
                      C: "Cholangiocarcinoma",
                      D: "Pancreatic adenocarcinoma"
                  },
                  correctAnswer: "C",
                  lecture: "Biliary and Pancreatic Pathology (Barrett)",
                  lo: 5,
                  rationale: "Cholangiocarcinoma is an adenocarcinoma arising from the bile duct epithelium. PSC is a major risk factor for this tumor, particularly those arising in the perihilar region (Klatskin tumors). Jaundice, weight loss, and pruritus in this setting are concerning for malignancy. (Source: Barrett - Biliary/Panc Path, Slide 13, 14)"
              },
              // Biliary/Panc Pathology (Barrett) - LO6 - Original, assesses application
              {
                  question: "A 58-year-old woman experiences recurrent episodes of symptomatic hypoglycemia, characterized by dizziness, confusion, and sweating, particularly when fasting or after exercise. Laboratory evaluation during an episode reveals low blood glucose with inappropriately high serum insulin and C-peptide levels. Imaging localizes a small mass in the tail of the pancreas. Biopsy of the mass shows nests of uniform cells with round to oval nuclei and eosinophilic to clear cytoplasm, consistent with a well-differentiated neuroendocrine tumor. Which specific type of pancreatic neuroendocrine tumor is most likely?",
                  options: {
                      A: "Gastrinoma",
                      B: "Glucagonoma",
                      C: "Insulinoma",
                      D: "Somatostatinoma"
                  },
                  correctAnswer: "C",
                  lecture: "Biliary and Pancreatic Pathology (Barrett)",
                  lo: 6,
                  rationale: "Insulinomas are functional pancreatic neuroendocrine tumors arising from beta cells, characterized by hypersecretion of insulin, leading to symptomatic hypoglycemia (Whipple's triad) with inappropriately high insulin and C-peptide levels. Gastrinomas cause ZES. Glucagonomas cause hyperglycemia. Somatostatinomas are rare and often asymptomatic or cause diabetes/steatorrhea. (Source: Barrett - Biliary/Panc Path, Slide 25, 26)"
              },
              // Cytochrome P450 (Lokeshwar) - LO1 - Rewritten for application
              {
                  question: "A pharmaceutical company is developing a new lipid-soluble drug. To facilitate its excretion from the body, the drug undergoes a metabolic process in the liver where functional groups like hydroxyl groups are added or exposed. This process is catalyzed primarily by enzymes like cytochrome P450 and prepares the drug for subsequent conjugation, making it more water-soluble. Which phase of drug metabolism is described?",
                  options: {
                      A: "Phase I metabolism",
                      B: "Phase II metabolism",
                      C: "Phase III metabolism (transport)",
                      D: "Renal excretion"
                  },
                  correctAnswer: "A",
                  lecture: "Cytochrome P450 Liver Metabolism (Lokeshwar)",
                  lo: 1,
                  rationale: "Phase I reactions, often catalyzed by CYP450 enzymes, introduce or expose polar functional groups (like -OH) on the drug molecule through oxidation, reduction, or hydrolysis. This increases water solubility and creates sites for Phase II conjugation. (Source: Lokeshwar, Slide 7, 14)"
              },
              // Cytochrome P450 (Lokeshwar) - LO2 - Original, assesses recall
              {
                  question: "The cytochrome P450 system is a large superfamily of enzymes involved in the metabolism of many drugs and xenobiotics. They are classified into families and subfamilies based on amino acid sequence homology. In the standardized nomenclature, what level of classification is represented by the number immediately following 'CYP' (e.g., the '3' in CYP3A4)?",
                  options: {
                      A: "The specific gene number",
                      B: "The subfamily",
                      C: "The family",
                      D: "The chromosome location"
                  },
                  correctAnswer: "C",
                  lecture: "Cytochrome P450 Liver Metabolism (Lokeshwar)",
                  lo: 2,
                  rationale: "In the CYP gene nomenclature (CYP#Letter#), the number immediately after 'CYP' indicates the gene family (e.g., CYP3). Families share at least 40% amino acid sequence homology. (Source: Lokeshwar, Slide 15)"
              },
              // Cytochrome P450 (Lokeshwar) - LO3 - Original, assesses recall
              {
                  question: "Cytochrome P450 enzymes are crucial for drug metabolism and are found in various tissues, with the highest concentration in the liver. Within hepatocytes, where are the majority of the drug-metabolizing CYP450 enzymes located?",
                  options: {
                      A: "Nucleus",
                      B: "Mitochondria",
                      C: "Smooth endoplasmic reticulum (SER)",
                      D: "Peroxisomes"
                  },
                  correctAnswer: "C",
                  lecture: "Cytochrome P450 Liver Metabolism (Lokeshwar)",
                  lo: 3,
                  rationale: "Most drug-metabolizing CYP450 enzymes are bound to the membrane of the smooth endoplasmic reticulum (SER) in hepatocytes. Mitochondrial CYP enzymes are involved in other metabolic pathways like steroid synthesis. (Source: Lokeshwar, Slide 13)"
              },
              // Cytochrome P450 (Lokeshwar) - LO5 - Original, assesses application
              {
                  question: "A patient takes an overdose of acetaminophen. At high doses, the main Phase II metabolism pathways become saturated, leading to increased metabolism of acetaminophen by cytochrome P450 enzymes (specifically CYP2E1) to a highly reactive and toxic intermediate, N-acetyl-p-benzoquinone imine (NAPQI). This intermediate can cause severe liver damage (hepatotoxicity) if cellular glutathione stores are depleted. In this scenario, the role of CYP2E1 is to:",
                  options: {
                      A: "Facilitate renal excretion of acetaminophen",
                      B: "Generate the toxic metabolite NAPQI",
                      C: "Detoxify NAPQI by conjugating it with glutathione",
                      D: "Increase the therapeutic effect of acetaminophen"
                  },
                  correctAnswer: "B",
                  lecture: "Cytochrome P450 Liver Metabolism (Lokeshwar)",
                  lo: 5,
                  rationale: "While Phase II metabolism is the primary pathway for acetaminophen at therapeutic doses, CYP2E1 becomes significant in overdose, converting acetaminophen to the toxic intermediate NAPQI. This CYP-mediated pathway is responsible for generating the hepatotoxic substance when conjugation pathways are overwhelmed. (Source: Lokeshwar, Slide 18, 20, 21, 22)"
              },
              // Cytochrome P450 (Lokeshwar) - LO6 - Original, assesses application
              {
                  question: "A patient receiving a stable dose of warfarin, primarily metabolized by CYP2C9, is prescribed a new medication, amiodarone, for a cardiac arrhythmia. Amiodarone is a known inhibitor of CYP2C9. This drug-drug interaction is most likely to result in:",
                  options: {
                      A: "Decreased warfarin plasma concentrations and increased risk of thrombosis",
                      B: "Increased warfarin plasma concentrations and increased risk of bleeding",
                      C: "Increased amiodarone plasma concentrations and increased risk of toxicity",
                      D: "Decreased amiodarone plasma concentrations and reduced efficacy"
                  },
                  correctAnswer: "B",
                  lecture: "Cytochrome P450 Liver Metabolism (Lokeshwar)",
                  lo: 6,
                  rationale: "When a drug (amiodarone) inhibits the metabolism of another drug (warfarin) that is cleared by the same enzyme (CYP2C9), the levels of the substrate drug (warfarin) will increase. Higher warfarin levels increase the anticoagulant effect, leading to a higher risk of bleeding. (Source: Lokeshwar, Slide 23, 26)"
              },
              // Pharmacogenomics (Winston) - LO1 - Original, assesses recall
              {
                  question: "The field of medicine that aims to personalize drug therapy by considering how an individual's genetic makeup affects their response to drugs is called:",
                  options: {
                      A: "Pharmacokinetics",
                      B: "Pharmacodynamics",
                      C: "Pharmacogenomics",
                      D: "Toxicology"
                  },
                  correctAnswer: "C",
                  lecture: "Pharmacogenomics (Winston)",
                  lo: 1,
                  rationale: "Pharmacogenomics is the study of how variations in a person's genetic makeup affect their drug response. It combines pharmacology (the study of drugs) and genomics (the study of genes) to optimize drug therapy for individual patients. (Source: Winston, Slide 3)"
              },
               // Pharmacogenomics (Winston) - LO2/4 - Rewritten for application
               {
                   question: "Warfarin dosing is highly variable among individuals due to genetic factors affecting both its metabolism (CYP2C9) and its target enzyme (VKORC1). Variations in the VKORC1 gene affect the sensitivity of the target enzyme to warfarin. This type of genetic variation specifically influence:",
                   options: {
                       A: "Warfarin absorption rate",
                       B: "Warfarin distribution volume",
                       C: "The rate of warfarin metabolism",
                       D: "The sensitivity of the drug target (Pharmacodynamics)"
                   },
                   correctAnswer: "D",
                   lecture: "Pharmacogenomics (Winston)",
                   lo: 2, // Identifies a drug target gene variation
                   rationale: "Genetic variations in VKORC1 alter the enzyme's activity level or binding affinity for warfarin, directly affecting the target's response to the drug. This is a pharmacodynamic effect, determining how sensitive the target is to the drug concentration. (Source: Winston, Slide 11, 31, 32)"
               },
               // Pharmacogenomics (Winston) - LO3 - Original, assesses recall
              {
                  question: "Genetic variation in DNA sequence can take several forms, including changes in single nucleotide bases. A variation where a single nucleotide base is changed in the DNA sequence is called a:",
                  options: {
                      A: "Deletion",
                      B: "Insertion",
                      C: "Single Nucleotide Polymorphism (SNP)",
                      D: "Copy Number Variation (CNV)"
                  },
                  correctAnswer: "C",
                  lecture: "Pharmacogenomics (Winston)",
                  lo: 3,
                  rationale: "A Single Nucleotide Polymorphism (SNP) is the most common type of genetic variation, involving a substitution of a single nucleotide base at a specific position in the genome. (Source: Winston, Slide 7, 8)"
              },
              // Pharmacogenomics (Winston) - LO4 - Original, assesses application
               {
                   question: "A patient of Han Chinese descent is prescribed carbamazepine. Genetic testing for HLA-B*15:02 is strongly recommended for patients of Asian ancestry prior to initiating carbamazepine therapy. The primary reason for this pharmacogenomic test is to:",
                   options: {
                       A: "Predict the patient's likely therapeutic response to carbamazepine",
                       B: "Identify patients at increased risk of developing a severe skin reaction (Stevens-Johnson syndrome/toxic epidermal necrolysis)",
                       C: "Determine the optimal starting dose of carbamazepine based on metabolism",
                       D: "Confirm the diagnosis for which carbamazepine is prescribed"
                   },
                   correctAnswer: "B",
                   lecture: "Pharmacogenomics (Winston)",
                   lo: 4,
                   rationale: "The HLA-B*15:02 allele is a strong predictor of severe, potentially life-threatening skin reactions (SJS/TEN) to carbamazepine, particularly in individuals of Asian ancestry. Testing is performed to identify these high-risk patients so alternative medications can be used, enhancing patient safety. (Source: Winston, Slide 14, 15, 37)"
               },
              // Pharmacogenomics (Winston) - LO5 - Original, assesses application
              {
                  question: "A patient is prescribed codeine for pain. Codeine is a prodrug that must be converted to its active form, morphine, by the enzyme CYP2D6. Genetic testing reveals the patient is a CYP2D6 poor metabolizer. How would the patient's genetic profile likely affect their response to codeine therapy?",
                  options: {
                      A: "The patient will likely experience enhanced pain relief due to increased morphine levels.",
                      B: "The patient will likely experience poor pain relief due to reduced conversion of codeine to morphine.",
                      C: "The patient will likely have increased codeine plasma levels but normal pain relief.",
                      D: "The patient will likely experience increased side effects from codeine."
                  },
                  correctAnswer: "B",
                  lecture: "Pharmacogenomics (Winston)",
                  lo: 5,
                  rationale: "CYP2D6 poor metabolizers have significantly reduced or absent enzyme activity. Since codeine activation to morphine depends on CYP2D6, poor metabolizers will produce very little morphine, resulting in inadequate pain relief. (Source: Winston, Slide 22, 23, 24, 37)"
              },
              // Pancreatic Disorders (Sridhar) - LO1 - Original, assesses application
              {
                  question: "A 55-year-old man with a history of heavy alcohol use presents with chronic upper abdominal pain, steatorrhea, and weight loss. Imaging reveals pancreatic calcifications and dilation of the pancreatic duct. These findings of irreversible damage and functional impairment are characteristic of which pancreatic condition?",
                  options: {
                      A: "Acute pancreatitis",
                      B: "Chronic pancreatitis",
                      C: "Pancreatic cancer",
                      D: "Autoimmune pancreatitis"
                  },
                  correctAnswer: "B",
                  lecture: "Diagnosis and Management of Pancreatic Disorders (Sridhar)",
                  lo: 1,
                  rationale: "Chronic pancreatitis is a disease of the pancreas characterized by progressive and irreversible structural damage (fibrosis, calcifications, ductal changes), leading to chronic pain and loss of exocrine and sometimes endocrine function (malabsorption, diabetes). Alcohol is a common cause. (Source: Sridhar - Panc Dis, Slide 2, 7, 20; Barrett - Biliary/Panc Path Slide 20)"
              },
               // Pancreatic Disorders (Sridhar) - LO2 - Original, assesses application
              {
                  question: "A patient presents to the emergency department with sudden onset of severe epigastric pain radiating to the back, accompanied by nausea and vomiting. Physical examination reveals diffuse upper abdominal tenderness. Laboratory tests show serum lipase and amylase levels that are more than three times the upper limit of normal. These clinical and laboratory findings strongly suggest:",
                  options: {
                      A: "Peptic ulcer perforation",
                      B: "Acute cholecystitis",
                      C: "Acute pancreatitis",
                      D: "Biliary colic"
                  },
                  correctAnswer: "C",
                  lecture: "Diagnosis and Management of Pancreatic Disorders (Sridhar)",
                  lo: 2,
                  rationale: "Acute pancreatitis is typically diagnosed based on the presence of at least two of the following: characteristic abdominal pain (acute onset, severe, epigastric, often radiating to the back), serum amylase or lipase levels at least three times the upper limit of normal, and characteristic findings on cross-sectional imaging. (Source: Sridhar - Panc Dis, Slide 9, 17, 20)"
              },
              // Chronic Liver Disease (Sridhar) - LO3 - Original, assesses application
              {
                  question: "A patient with cirrhosis and ascites is admitted with fever, abdominal pain, and altered mental status. A diagnostic paracentesis reveals ascitic fluid with a neutrophil count of 450 cells/mm³. This finding confirms a diagnosis of spontaneous bacterial peritonitis (SBP). What is the most appropriate initial management step for this patient?",
                  options: {
                      A: "Administer a diuretic (e.g., spironolactone)",
                      B: "Initiate broad-spectrum intravenous antibiotics (e.g., cefotaxime)",
                      C: "Perform large volume paracentesis",
                      D: "Schedule placement of a transjugular intrahepatic portosystemic shunt (TIPS)"
                  },
                  correctAnswer: "B",
                  lecture: "Chronic Liver Disease, Cirrhosis, and Portal Hypertension (Sridhar)",
                  lo: 3,
                  rationale: "Spontaneous bacterial peritonitis (SBP) is an infection of ascitic fluid in patients with cirrhosis, diagnosed by an ascitic fluid neutrophil count > 250 cells/mm³. It is a medical emergency requiring prompt treatment with broad-spectrum antibiotics. While paracentesis is diagnostic and can be therapeutic, antibiotics are the priority for treating the infection. (Source: Sridhar - Cirrhosis, Slide 21, 24, 25)"
              },
              // Fat Soluble Vitamins (Prasad) - LO1 - Original, assesses application
              {
                  question: "A patient is diagnosed with a severe fat malabsorption syndrome. This condition impairs the absorption of certain nutrients from the diet, even if intake is adequate. Which class of vitamins is most directly affected by fat malabsorption, potentially leading to deficiency?",
                  options: {
                      A: "Water-soluble vitamins (B complex, C)",
                      B: "Fat-soluble vitamins (A, D, E, K)",
                      C: "Major minerals (calcium, potassium)",
                      D: "Protein and amino acids"
                  },
                  correctAnswer: "B",
                  lecture: "Fat Soluble Vitamins (Prasad)",
                  lo: 1,
                  rationale: "Fat-soluble vitamins (A, D, E, K) are absorbed along with dietary fats. Conditions causing fat malabsorption, such as cystic fibrosis or celiac disease, interfere with this process, increasing the risk of deficiencies in these vitamins. Water-soluble vitamins and minerals have different absorption mechanisms. (Source: Prasad, Slide 4)"
              },
              // Fat Soluble Vitamins (Prasad) - LO3 (Vit A) - Original, assesses application
              {
                  question: "A child presents with complaints of poor vision at night. Examination reveals dry conjunctiva with triangular, white, foamy patches (Bitot's spots) on the temporal side. These clinical signs are most indicative of a deficiency in which vitamin, critical for the formation of rhodopsin in the retina?",
                  options: {
                      A: "Vitamin A",
                      B: "Vitamin D",
                      C: "Vitamin E",
                      D: "Vitamin K"
                  },
                  correctAnswer: "A",
                  lecture: "Fat Soluble Vitamins (Prasad)",
                  lo: 3,
                  rationale: "Vitamin A deficiency is a major cause of preventable blindness worldwide. Early symptoms include night blindness (nyctalopia), followed by xerophthalmia (dryness of conjunctiva and cornea) and characteristic Bitot's spots. Vitamin A is essential for the synthesis of rhodopsin, the light-sensitive pigment in rod cells. (Source: Prasad, Slide 7, 9, 10)"
              },
              // Fat Soluble Vitamins (Prasad) - LO3 (Vit K) - Rewritten for clarity, focuses on vitamin
              {
                  question: "A 6-week-old infant, exclusively breastfed and who did not receive a vitamin injection at birth, presents with signs of bleeding, including intracranial hemorrhage. Laboratory tests show a markedly prolonged prothrombin time (PT) and activated partial thromboplastin time (aPTT). Deficiency of which vitamin is the most likely cause of this bleeding disorder, often seen in newborns?",
                  options: {
                      A: "Vitamin A",
                      B: "Vitamin D",
                      C: "Vitamin E",
                      D: "Vitamin K"
                  },
                  correctAnswer: "D",
                  lecture: "Fat Soluble Vitamins (Prasad)",
                  lo: 3,
                  rationale: "Vitamin K is essential for the gamma-carboxylation of clotting factors II, VII, IX, and X. Newborns have limited vitamin K stores and low levels in breast milk, making them susceptible to Vitamin K Deficiency Bleeding (VKDB) if they don't receive prophylaxis at birth. Prolonged PT/aPTT indicates a deficiency in these factors. (Source: Prasad, Slide 33, 34, 36)"
              }
              // Note: Questions related to the excluded learning objectives (Histopathology Lab, TBL Hepatitis Serologies) were not included in this refactoring.
        ];

        const quizContainer = document.getElementById('quiz-container');
        const themeToggleButton = document.getElementById('theme-toggle-button');
        const bodyElement = document.body;

        function applyTheme(theme) {
            if (theme === 'light') {
                bodyElement.classList.add('light-theme');
                themeToggleButton.textContent = 'Switch to Dark Mode';
            } else {
                bodyElement.classList.remove('light-theme');
                themeToggleButton.textContent = 'Switch to Light Mode';
            }
            localStorage.setItem('quizTheme', theme); // Save preference
        }

        function loadQuiz() {
            quizData.forEach((qData, index) => {
                const questionBlock = document.createElement('div');
                questionBlock.classList.add('question-block');
                questionBlock.id = `q${index}`;

                const lectureSource = document.createElement('div');
                lectureSource.classList.add('lecture-source');
                lectureSource.textContent = `Source: ${qData.lecture} (LO ${qData.lo})`;
                questionBlock.appendChild(lectureSource);

                const questionText = document.createElement('p');
                questionText.classList.add('question-text');
                questionText.innerHTML = `${index + 1}. ${qData.question}`;
                questionBlock.appendChild(questionText);

                const optionsDiv = document.createElement('div');
                optionsDiv.classList.add('options');

                for (const optionKey in qData.options) {
                    const optionId = `q${index}_${optionKey}`;

                    const radioInput = document.createElement('input');
                    radioInput.type = 'radio';
                    radioInput.name = `q${index}`;
                    radioInput.value = optionKey;
                    radioInput.id = optionId;
                     // Add event listener for unchecking
                    radioInput.onclick = handleRadioClick;

                    const label = document.createElement('label');
                    label.htmlFor = optionId;

                    const labelText = document.createElement('span');
                    labelText.textContent = `${optionKey}. ${qData.options[optionKey]}`;

                    label.appendChild(radioInput);
                    label.appendChild(labelText);

                    optionsDiv.appendChild(label);
                }
                questionBlock.appendChild(optionsDiv);

                const checkButton = document.createElement('button');
                checkButton.textContent = 'Check Answer';
                checkButton.classList.add('check-button');
                checkButton.onclick = () => checkAnswer(index);
                questionBlock.appendChild(checkButton);

                const feedbackDiv = document.createElement('div');
                feedbackDiv.classList.add('feedback');
                questionBlock.appendChild(feedbackDiv);

                quizContainer.appendChild(questionBlock);
            });
        }

        let lastCheckedRadio = {}; // Store the last checked radio for each question group

        function handleRadioClick(event) {
            const currentRadio = event.target;
            const groupName = currentRadio.name;

            // If this radio was already the last one checked for this group, uncheck it
            if (lastCheckedRadio[groupName] === currentRadio) {
                currentRadio.checked = false;
                lastCheckedRadio[groupName] = null; // Reset the last checked
            } else {
                // Otherwise, update the last checked radio for this group
                lastCheckedRadio[groupName] = currentRadio;
            }
        }


        function checkAnswer(questionIndex) {
            const questionBlockElement = document.getElementById(`q${questionIndex}`);
            const selectedRadioButton = questionBlockElement.querySelector('input[type="radio"]:checked');

            // No changes needed to prevent checking if already 'answered'
            // because we want to allow re-checking

            if (!selectedRadioButton) {
                alert("Please select an answer first.");
                return;
            }

            // No longer adding 'answered' class
            // questionBlockElement.classList.add('answered');

            const selectedOptionKey = selectedRadioButton.value;
            const qData = quizData[questionIndex];
            const feedbackDiv = questionBlockElement.querySelector('.feedback');
            const correct = selectedOptionKey === qData.correctAnswer;

            let feedbackHTML = '';

            if (correct) {
                feedbackHTML = `<span class="feedback-status">Correct!</span>`;
                feedbackDiv.className = 'feedback correct'; // Set class for styling
            } else {
                 feedbackHTML = `<span class="feedback-status">Incorrect.</span> The correct answer is ${qData.correctAnswer}.`;
                 feedbackDiv.className = 'feedback incorrect'; // Set class for styling
            }

            feedbackHTML += `<div class="feedback-rationale"><strong>Rationale:</strong> ${qData.rationale}</div>`;
            feedbackDiv.innerHTML = feedbackHTML;

            // DO NOT disable radio buttons or check button anymore
            /*
            const radioButtons = questionBlockElement.querySelectorAll('input[type="radio"]');
            radioButtons.forEach(rb => { rb.disabled = true; });
            const checkButton = questionBlockElement.querySelector('.check-button');
            checkButton.disabled = true;
            */
        }

        // Theme Toggling Logic
        themeToggleButton.addEventListener('click', () => {
            if (bodyElement.classList.contains('light-theme')) {
                applyTheme('dark');
            } else {
                applyTheme('light');
            }
        });

        // Load Initial Theme & Quiz
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('quizTheme') || 'dark'; // Default to dark
            applyTheme(savedTheme);
            loadQuiz();
        });

    </script>

</body>
</html>